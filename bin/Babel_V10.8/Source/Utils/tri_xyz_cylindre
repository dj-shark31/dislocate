#!/bin/sh

# Ce script permet de trier les atomes d'un fichier xyz
# suivant leur distance à l'axe d'un cylindre.
# L'axe du cylindre est définit par une origine et sa direction.
# Un indice est alors attaché à chaque atome suivant qu'ils appartiennent
# aux zones 1, 2 ou 3 définies par les rayons de coupure R1 et R2

#### Variables ######
file="fe_bcc_unsorted.xyz"	# Fichier input
x0="0" ; y0="0" ; z0="0"		# Origine de l'axe du cylindre
lx="1" ; ly="0" ; lz="0"		# Direction de l'axe du cylindre
R1="190" ; R2="197"	# Rayons définissant les régions 1 et 2
#####################

export LC_ALL="C"
# Récupération du nombre d'atomes
nAtom=`head -1 $file`
echo $nAtom

# Récupération du titre
title=`head -2 $file | tail -1`
echo $title

# Liste d'atomes triée
tail -n +3 $file | head -n $nAtom \
	| awk -vx0="$x0" -vy0="$y0" -vz0="$z0" -vlx="$lx" -vly="$ly" -vlz="$lz" \
		'{x=$2-x0 ; y=$3-y0 ; z=$4-z0 ;  
		d2=((y*lz-z*ly)^2+(z*lx-x*lz)^2+(x*ly-y*lx)^2)/(lx^2+ly^2+lz^2) ;
		print $1"\t"$2"\t"$3"\t"$4"\t"d2}' \
	| sort -n -k 5 | awk -vR1="$R1" -vR2="$R2" \
		'{if ($5<=R1^2) print $1"\t"$2"\t"$3"\t"$4"\t1"
		else if ($5<=R2^2) print $1"\t"$2"\t"$3"\t"$4"\t2"
		else print $1"\t"$2"\t"$3"\t"$4"\t3"}'
tail -n +4 $file | tail -n +$nAtom	# Ecriture 
